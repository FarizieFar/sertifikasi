<!DOCTYPE html>
<html>
<head>
  <title>Arsip Surat</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Import font dari Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
    h1 {
      font-weight: 600;
      color: #0d6efd;
    }
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px; /* Jarak antar tombol */
    }
  </style>
</head>
<body class="container mt-4">
  <h1 class="mb-4 text-center">Arsip Surat Desa Karangduren</h1>

  <!-- Bagian pencarian -->
  <div class="row mb-3">
    <div class="col-md-6 d-flex">
      <input id="search" class="form-control me-2" placeholder="Cari judul...">
      <button class="btn btn-primary" onclick="loadArchives()">Cari</button>
    </div>
    <div class="col-md-6 d-flex justify-content-end action-buttons">
      <a href="create.html" class="btn btn-success">Arsipkan Surat..</a>
      <a href="categories.html" class="btn btn-warning">Kategori Surat</a>
      <a href="about.html" class="btn btn-info">About</a>
    </div>
  </div>

  <!-- Tabel -->
  <table class="table table-bordered">
    <thead>
      <tr><th>Judul</th><th>Kategori</th><th>Tanggal</th><th>Aksi</th></tr>
    </thead>
    <tbody id="archiveTable"></tbody>
  </table>

  <script>
    async function loadArchives(){
      let q = document.getElementById('search').value;
      let res = await fetch('/api/archives?q='+q);
      let data = await res.json();
      let rows = data.map(a => `
        <tr>
          <td>${a.title}</td>
          <td>${a.category || '-'}</td>
          <td>${new Date(a.created_at).toLocaleDateString()}</td>
          <td>
            <a href="view.html?id=${a.id}" class="btn btn-sm btn-info">Lihat >></a>
            <a href="/api/archives/${a.id}/download" class="btn btn-sm btn-secondary">Unduh</a>
            <button class="btn btn-sm btn-danger" onclick="hapus(${a.id})">Hapus</button>
          </td>
        </tr>`).join('');
      document.getElementById('archiveTable').innerHTML = rows;
    }
    async function hapus(id){
      if(confirm("Yakin ingin hapus?")){
        await fetch('/api/archives/'+id, {method:'DELETE'});
        loadArchives();
      }
    }
    loadArchives();
  </script>
</body>
</html>
